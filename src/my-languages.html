<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/iron-form/iron-form.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/iron-icons/maps-icons.html">
<link rel="import" href="../bower_components/neon-animation/web-animations.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu-light.html">
<link rel="import" href="../bower_components/polymer/lib/elements/dom-repeat.html">
<link rel="import" href="app-styles.html">
<link rel="import" href="components/ks-info-card.html">


<dom-module id="my-languages">
    <template>
        <style include="app-styles">
            :host {
                display: block;
            }
            #language_name{
                width: 50%;
                margin-right: 20px;
            }
            #level_name{
                width: 50%;
                margin-top: 1px;
            }
        </style>
        <h1 class="data-header-name">Idioma</h1>
        <iron-form id="languageExperience">
            <form>
                <div class="flex-div">
                    <paper-input id="language_name" type="text" name="idioma" label="Idioma" required error-message="Campo requerido" 
                        value="{{language.name}}"></paper-input>
                    <paper-dropdown-menu-light id="level_name" label="Nivel">
                        <paper-listbox slot="dropdown-content" class="dropdown-content" selected={{level}} attr-for-selected="myvalue" required>
                            <template is="dom-repeat" items="[[levels]]" as="level">
                                <paper-item myvalue="[[level]]">{{level}}</paper-item>
                            </template>
                        </paper-listbox>
                    </paper-dropdown-menu-light>
                </div>
                <input is="iron-input" name="title" type="hidden" value$="[[level]]">
                <div class="save-buttons">
                    <paper-button class="save-and-continue paper-button-k" raised on-click="_addLanguage">Agregar</paper-button>
                    <paper-button class="save-and-continue paper-button-k" raised on-click="_saveData">Guardar y Continuar</paper-button>
                </div>
            </form>
        </iron-form>
        <div class="container-grid container-3-grid">
            <template is="dom-repeat" items="[[languages]]" as="language">
                <ks-info-card 
                    on-remove-item="_removeLanguage"
                    on-edit-item="_editLanguage"
                    aditional-data="{{language}}"
                    index="{{index}}">
                </ks-info-card>
            </template>
        </div>
    </template>

    <script>
        /**
         * `my-languages`
         *
         * @customElement
         * @polymer
         */
        class MyLanguage extends Polymer.Element {
            static get is() { return 'my-languages'; }
            static get properties() {
                return {
                    levels: {
                        type: Array,
                        value: ['Principiante', 'Intermedio', 'Avanzado', 'Nativo']
                    },
                    languages: {
                        type: Array,
                        value: []
                    },
                    level: {
                        type: Number,
                        value: 0,
                        notify: true
                    }
                };
            }

            connectedCallback() {
                super.connectedCallback();
            }

            _saveData(event) {
                if (this.languages.length > 0) {
                    localStorage.setItem('languages', JSON.stringify(this.languages));
                    this._dispatchEvent('save-info', this.languages);
                    console.info('Data saved!');
                }
            }

            _addLanguage(event) {
                if (this._validateForm()) {
                    const newLanguage = { name: this.$.language_name.value, level: this.level };
                    console.log(newLanguage);
                    this.push('languages', newLanguage);
                    this.resetForm();
                }
            }

            resetForm() {
                this.level = 'Principiante';
                this.$.language_name.value = null;
            }

            _validateForm() {
                return this.$.languageExperience.validate();
            }

            _removeLanguage(e) {
                const id = e.detail.index;
                this.splice('languages', id, 1);
            }

            _editLanguage(e) {
                const id = e.detail.index;
                this.level = this.languages[id].level;
                this.$.language_name.value = this.languages[id].name;
                this.splice('languages', id, 1);
            }

            _dispatchEvent(event, detail, bubbles = true) {
                this.dispatchEvent(new CustomEvent(event, {
                bubbles: bubbles,
                composed: true,
                detail: {
                    key: 'languages',
                    data: detail
                }
                }));
            }
        }

        window.customElements.define(MyLanguage.is, MyLanguage);
    </script>
</dom-module>