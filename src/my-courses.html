<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/iron-form/iron-form.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/polymer/lib/elements/dom-repeat.html">
<link rel="import" href="../bower_components/app-datepicker/app-datepicker-dialog.html">
<link rel="import" href="components/ks-info-card.html">

<dom-module id="my-courses">
    <template>
        <style include="app-styles">
            :host {
                display: block;
            }
        </style>
        <h1 class="data-header-name">Cursos y diplomados</h1>
        <iron-form id="coursesForm">
            <form>
                <paper-input id="course_name" type="text" name="course" label="Curso" required error-message="Campo requerido" value="{{name}}"></paper-input>
                <div class="datepicker-dialog">
                    <span>Fecha</span>
                    <paper-button disabled>{{date}}</paper-button>
                    <paper-icon-button icon="icons:today" on-tap="_openDialogInit"></paper-icon-button>
                    <app-datepicker-dialog id="dateInit" date="{{date}}" locale="es-ES">
                    </app-datepicker-dialog>
                </div>
                <paper-input id="course_institution" type="text" name="institution" label="InstituciÃ³n" required error-message="Campo requerido" value="{{institution}}"></paper-input>
                <div class="save-buttons">
                    <paper-button class="paper-button-k" raised on-click="_addCourse">Agregar</paper-button>
                    <paper-button class="paper-button-k save-and-continue" raised on-click="_saveData">guardar y continuar</paper-button>
                </div>
            </form>
        </iron-form>
        <div class="container-grid container-2-grid">
            <template is="dom-repeat" items="[[courses]]" as="curso">
                <ks-info-card 
                    on-remove-item="_removeCourse"
                    on-edit-item="_editCourse"
                    aditional-data="{{curso}}"
                    index="{{index}}">
                </ks-info-card>
            </template>
        </div>
    </template>

    <script>
        /**
         * `my-courses`
         *
         * @customElement
         * @polymer
         */
        class MyCourses extends Polymer.Element {
            static get is() { return 'my-courses'; }
            static get properties() {
                return {
                    courses: {
                        type: Array,
                        value: []
                    }, 
                    course: {
                        type: Object,
                        value: {}
                    }
                };
            }

            connectedCallback() {
                super.connectedCallback();
            }

            _openDialogInit(event) {
                this.$.dateInit.open();
            }

            _saveData(event) {
                if (this.courses.length > 0) {
                    this._dispatchEvent('save-info', this.courses);
                    console.info('Data saved!');
                }
            }

            _addCourse(event) {
                if (this._validateForm()) {
                    const COURSE = { name: this.name, date: this.date, institution: this.institution};
                    console.log(COURSE);
                    this.push('courses', COURSE);
                        this.resetForm();
                }
            }

            resetForm() {
                this.$.coursesForm.reset();
            }

            _validateForm() {
                return this.$.coursesForm.validate();
            }

            _removeCourse(e) {
                const id = e.detail.index;
                this.splice('courses', id, 1);
            }

            _editCourse(e) {
                const id = e.detail.index;
                this.set('date', this.courses[id].date);
                this.set('name', this.courses[id].name);
                this.set('institution', this.courses[id].institution);
                this.splice('courses', id, 1);
            }

            _dispatchEvent(event, detail, bubbles = true) {
                this.dispatchEvent(new CustomEvent(event, {
                bubbles: bubbles,
                composed: true,
                detail: {
                    key: 'courses',
                    data: detail
                }
                }));
            }
        }

        window.customElements.define(MyCourses.is, MyCourses);
    </script>
</dom-module>